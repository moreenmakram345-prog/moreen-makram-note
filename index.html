<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Notes</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    body {
      margin: 0;
      background: #f4f6f8;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 500px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 16px;
      color: #333;
    }

    input, textarea, button {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 15px;
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    button {
      background: #4f46e5;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.2s;
      margin-top: 10px;
    }

    button:hover {
      background: #4338ca;
    }

    .hidden {
      display: none;
    }

    .search {
      margin: 16px 0;
    }

    .notes {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .note {
      background: #f9fafb;
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      border: 1px solid #eee;
    }

    .note p {
      margin: 0;
      color: #333;
      line-height: 1.5;
      word-wrap: break-word;
    }

    .note-actions {
      display: flex;
      gap: 8px;
    }

    .edit-btn {
      background: #22c55e;
    }

    .edit-btn:hover {
      background: #16a34a;
    }

    .delete-btn {
      background: #ef4444;
    }

    .delete-btn:hover {
      background: #dc2626;
    }

    @media (max-width: 480px) {
      .app {
        padding: 16px;
      }
    }
  </style>
</head>
<body>

  <div class="app">
    <!-- Login -->
    <div id="login">
      <h1>Quick Notes</h1>
      <input type="text" id="usernameInput" placeholder="اكتب اسمك" />
      <button id="loginBtn">دخول</button>
    </div>

    <!-- App -->
    <div id="main" class="hidden">
      <h1 id="welcome"></h1>

      <textarea id="noteInput" placeholder="اكتب ملاحظتك..."></textarea>
      <button id="addNoteBtn">إضافة ملاحظة</button>

      <input type="text" id="searchInput" class="search" placeholder="بحث في الملاحظات..." />

      <div class="notes" id="notesContainer"></div>
    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = "https://jcuvklwfhskkbjrhnqxh.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjdXZrbHdmaHNra2JqcmhucXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODE1MjEsImV4cCI6MjA4MTM1NzUyMX0.bvSDRsGtdghIa6jLM1Ai61DHy6hbtVzzx6Y5LHxYipc";

     const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );
    const loginDiv = document.getElementById("login");
    const mainDiv = document.getElementById("main");
    const usernameInput = document.getElementById("usernameInput");
    const loginBtn = document.getElementById("loginBtn");
    const welcome = document.getElementById("welcome");

    const noteInput = document.getElementById("noteInput");
    const addNoteBtn = document.getElementById("addNoteBtn");
    const notesContainer = document.getElementById("notesContainer");
    const searchInput = document.getElementById("searchInput");

    let currentUser = localStorage.getItem("username") || "";

    function showApp() {
      loginDiv.classList.add("hidden");
      mainDiv.classList.remove("hidden");
      welcome.textContent = "مرحبًا، " + currentUser;
      loadNotes();
    }

    if (currentUser) {
      showApp();
    }

    loginBtn.onclick = () => {
      const name = usernameInput.value.trim();
      if (!name) return alert("اكتب اسمك");
      localStorage.setItem("username", name);
      currentUser = name;
      showApp();
    };

    async function loadNotes() {
      const { data, error } = await supabase
        .from("notes")
        .select("*")
        .eq("user_name", currentUser)
        .order("created_at", { ascending: false });

      if (!error) renderNotes(data);
    }

    function renderNotes(notes) {
      const query = searchInput.value.toLowerCase();
      notesContainer.innerHTML = "";

      notes
        .filter(n => n.content.toLowerCase().includes(query))
        .forEach(note => {
          const card = document.createElement("div");
          card.className = "note";

          const p = document.createElement("p");
          p.textContent = note.content;

          const actions = document.createElement("div");
          actions.className = "note-actions";

          const editBtn = document.createElement("button");
          editBtn.textContent = "تعديل";
          editBtn.className = "edit-btn";
          editBtn.onclick = () => editNote(note);

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "حذف";
          deleteBtn.className = "delete-btn";
          deleteBtn.onclick = () => deleteNote(note.id);

          actions.append(editBtn, deleteBtn);
          card.append(p, actions);
          notesContainer.appendChild(card);
        });
    }

    addNoteBtn.onclick = async () => {
      const content = noteInput.value.trim();
      if (!content) return;

      await supabase.from("notes").insert({
        user_name: currentUser,
        content: content
      });

      noteInput.value = "";
      loadNotes();
    };

    async function editNote(note) {
      const newContent = prompt("عدل الملاحظة:", note.content);
      if (!newContent) return;

      await supabase
        .from("notes")
        .update({ content: newContent })
        .eq("id", note.id);

      loadNotes();
    }

    async function deleteNote(id) {
      if (!confirm("هل أنت متأكد من حذف الملاحظة؟")) return;

      await supabase
        .from("notes")
        .delete()
        .eq("id", id);

      loadNotes();
    }

    searchInput.oninput = loadNotes;
  </script>
</body>
</html>
